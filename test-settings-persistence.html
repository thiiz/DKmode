<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Settings Persistence Test - Dark Theme Extension</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }

    .container {
      background: white;
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    h1 {
      color: #333;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
      margin-top: 0;
    }

    h2 {
      color: #667eea;
      margin-top: 30px;
      font-size: 1.3em;
    }

    .test-section {
      background: #f8f9fa;
      border-left: 4px solid #667eea;
      padding: 20px;
      margin: 20px 0;
      border-radius: 4px;
    }

    .test-step {
      background: white;
      padding: 15px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #e0e0e0;
    }

    .step-number {
      display: inline-block;
      background: #667eea;
      color: white;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      text-align: center;
      line-height: 30px;
      font-weight: bold;
      margin-right: 10px;
    }

    .checkbox-item {
      margin: 10px 0;
      padding: 10px;
      background: #f0f0f0;
      border-radius: 4px;
    }

    input[type="checkbox"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    label {
      cursor: pointer;
      font-size: 1em;
    }

    .info-box {
      background: #e3f2fd;
      border-left: 4px solid #2196F3;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    .success-box {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin: 15px 0;
      border-radius: 4px;
    }

    .test-content {
      background: white;
      padding: 20px;
      margin: 15px 0;
      border-radius: 8px;
      border: 2px dashed #ccc;
    }

    .test-content h3 {
      margin-top: 0;
      color: #555;
    }

    .test-content p {
      line-height: 1.6;
      color: #666;
    }

    code {
      background: #f4f4f4;
      padding: 2px 6px;
      border-radius: 3px;
      font-family: 'Courier New', monospace;
      color: #d63384;
    }

    .button-group {
      margin: 20px 0;
    }

    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      margin-right: 10px;
      transition: background 0.3s;
    }

    button:hover {
      background: #5568d3;
    }

    button:active {
      transform: scale(0.98);
    }

    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }

    .status-pending {
      background: #ffc107;
    }

    .status-pass {
      background: #28a745;
    }

    .status-fail {
      background: #dc3545;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    th,
    td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }

    th {
      background: #667eea;
      color: white;
      font-weight: 600;
    }

    tr:hover {
      background: #f5f5f5;
    }

    .note {
      font-style: italic;
      color: #666;
      font-size: 0.9em;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üîÑ Settings Persistence & Sync Test</h1>

    <div class="info-box">
      <strong>üìã Test Objective:</strong> Verify that all extension settings persist correctly after closing the popup,
      restarting the browser, and sync across Chrome instances. This test covers Requirements 5.1, 5.2, 5.3, and 5.4.
    </div>

    <h2>Test 1: Popup Settings Persistence</h2>
    <div class="test-section">
      <p><strong>Goal:</strong> Verify settings persist after closing and reopening the popup</p>

      <div class="test-step">
        <span class="step-number">1</span>
        <strong>Open the extension popup</strong>
        <p class="note">Click the extension icon in the Chrome toolbar</p>
      </div>

      <div class="test-step">
        <span class="step-number">2</span>
        <strong>Change the following settings:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="toggle-check">
          <label for="toggle-check">Toggle dark theme ON/OFF</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="intensity-check">
          <label for="intensity-check">Adjust intensity slider to a specific value (e.g., 65%)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="site-check">
          <label for="site-check">Add a site to whitelist or blacklist (if UI is available)</label>
        </div>
      </div>

      <div class="test-step">
        <span class="step-number">3</span>
        <strong>Close the popup</strong>
        <p class="note">Click outside the popup or press Escape</p>
      </div>

      <div class="test-step">
        <span class="step-number">4</span>
        <strong>Reopen the popup immediately</strong>
        <p class="note">Click the extension icon again</p>
      </div>

      <div class="test-step">
        <span class="step-number">5</span>
        <strong>Verify all settings are retained:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="verify-toggle">
          <label for="verify-toggle">Dark theme toggle is in the same state</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="verify-intensity">
          <label for="verify-intensity">Intensity slider shows the same value</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="verify-site">
          <label for="verify-site">Site lists show the added site</label>
        </div>
      </div>

      <div class="success-box">
        <strong>‚úÖ Expected Result:</strong> All settings should be exactly as you left them before closing the popup.
      </div>
    </div>

    <h2>Test 2: Browser Restart Persistence</h2>
    <div class="test-section">
      <p><strong>Goal:</strong> Verify settings survive a complete browser restart</p>

      <div class="test-step">
        <span class="step-number">1</span>
        <strong>Configure specific settings in the popup:</strong>
        <ul>
          <li>Enable dark theme</li>
          <li>Set intensity to 75%</li>
          <li>Add "example.com" to whitelist (if available)</li>
          <li>Add "test.com" to blacklist (if available)</li>
        </ul>
      </div>

      <div class="test-step">
        <span class="step-number">2</span>
        <strong>Note the current settings</strong>
        <p class="note">Write down or screenshot the current state</p>
        <table>
          <tr>
            <th>Setting</th>
            <th>Value Before Restart</th>
            <th>Value After Restart</th>
          </tr>
          <tr>
            <td>Dark Theme Enabled</td>
            <td>_____________</td>
            <td>_____________</td>
          </tr>
          <tr>
            <td>Intensity</td>
            <td>_____________</td>
            <td>_____________</td>
          </tr>
          <tr>
            <td>Whitelist Sites</td>
            <td>_____________</td>
            <td>_____________</td>
          </tr>
          <tr>
            <td>Blacklist Sites</td>
            <td>_____________</td>
            <td>_____________</td>
          </tr>
        </table>
      </div>

      <div class="test-step">
        <span class="step-number">3</span>
        <strong>Close Chrome completely</strong>
        <p class="note">Use File ‚Üí Exit or close all Chrome windows. Ensure Chrome is not running in the background.</p>
      </div>

      <div class="test-step">
        <span class="step-number">4</span>
        <strong>Reopen Chrome</strong>
        <p class="note">Start Chrome fresh</p>
      </div>

      <div class="test-step">
        <span class="step-number">5</span>
        <strong>Open the extension popup</strong>
        <p class="note">Click the extension icon</p>
      </div>

      <div class="test-step">
        <span class="step-number">6</span>
        <strong>Verify all settings match the values before restart:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="restart-toggle">
          <label for="restart-toggle">Dark theme toggle state is preserved</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="restart-intensity">
          <label for="restart-intensity">Intensity value is preserved (75%)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="restart-whitelist">
          <label for="restart-whitelist">Whitelist contains "example.com"</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="restart-blacklist">
          <label for="restart-blacklist">Blacklist contains "test.com"</label>
        </div>
      </div>

      <div class="success-box">
        <strong>‚úÖ Expected Result:</strong> All settings should be identical to before the browser restart.
      </div>
    </div>

    <h2>Test 3: Cross-Instance Sync (Chrome Sync)</h2>
    <div class="test-section">
      <p><strong>Goal:</strong> Verify settings sync across Chrome instances using Chrome Sync</p>

      <div class="warning-box">
        <strong>‚ö†Ô∏è Prerequisites:</strong>
        <ul>
          <li>You must be signed into Chrome with a Google account</li>
          <li>Chrome Sync must be enabled (Settings ‚Üí Sync and Google services)</li>
          <li>You need access to either:
            <ul>
              <li>Another device with Chrome (phone, tablet, another computer), OR</li>
              <li>Another Chrome profile on the same computer</li>
            </ul>
          </li>
        </ul>
      </div>

      <h3>Option A: Testing with Multiple Devices</h3>
      <div class="test-step">
        <span class="step-number">1</span>
        <strong>On Device 1 (Primary):</strong>
        <ul>
          <li>Install the extension</li>
          <li>Configure specific settings (e.g., enable dark theme, set intensity to 80%)</li>
          <li>Add sites to whitelist/blacklist</li>
        </ul>
      </div>

      <div class="test-step">
        <span class="step-number">2</span>
        <strong>Wait for sync (usually 1-2 minutes)</strong>
        <p class="note">Chrome Sync happens automatically in the background</p>
      </div>

      <div class="test-step">
        <span class="step-number">3</span>
        <strong>On Device 2 (Secondary):</strong>
        <ul>
          <li>Ensure you're signed into the same Google account</li>
          <li>Install the same extension</li>
          <li>Open the extension popup</li>
        </ul>
      </div>

      <div class="test-step">
        <span class="step-number">4</span>
        <strong>Verify settings match Device 1:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="sync-toggle">
          <label for="sync-toggle">Dark theme state matches</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="sync-intensity">
          <label for="sync-intensity">Intensity value matches (80%)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="sync-lists">
          <label for="sync-lists">Whitelist and blacklist match</label>
        </div>
      </div>

      <h3>Option B: Testing with Chrome Profiles</h3>
      <div class="test-step">
        <span class="step-number">1</span>
        <strong>Create a second Chrome profile:</strong>
        <ul>
          <li>Click your profile icon in Chrome toolbar</li>
          <li>Select "Add" to create a new profile</li>
          <li>Sign in with the same Google account</li>
          <li>Enable Chrome Sync</li>
        </ul>
      </div>

      <div class="test-step">
        <span class="step-number">2</span>
        <strong>In Profile 1:</strong>
        <ul>
          <li>Configure extension settings</li>
          <li>Note the exact values</li>
        </ul>
      </div>

      <div class="test-step">
        <span class="step-number">3</span>
        <strong>Switch to Profile 2:</strong>
        <ul>
          <li>Install the extension (if not already installed)</li>
          <li>Wait 1-2 minutes for sync</li>
          <li>Open the extension popup</li>
        </ul>
      </div>

      <div class="test-step">
        <span class="step-number">4</span>
        <strong>Verify settings are synced:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="profile-sync">
          <label for="profile-sync">All settings match between profiles</label>
        </div>
      </div>

      <div class="success-box">
        <strong>‚úÖ Expected Result:</strong> Settings should automatically sync across all Chrome instances signed into
        the same account.
      </div>

      <div class="info-box">
        <strong>üí° Note:</strong> If sync doesn't work immediately, try:
        <ul>
          <li>Manually triggering sync: chrome://sync-internals ‚Üí "Request Start"</li>
          <li>Checking sync status: Settings ‚Üí Sync and Google services</li>
          <li>Waiting a few more minutes (sync can be delayed)</li>
        </ul>
      </div>
    </div>

    <h2>Test 4: Site-Specific Settings Persistence</h2>
    <div class="test-section">
      <p><strong>Goal:</strong> Verify per-site settings persist correctly</p>

      <div class="test-step">
        <span class="step-number">1</span>
        <strong>Navigate to this test page</strong>
        <p class="note">You're already here!</p>
      </div>

      <div class="test-step">
        <span class="step-number">2</span>
        <strong>Open the extension popup and enable dark theme</strong>
        <p class="note">The page should turn dark</p>
      </div>

      <div class="test-step">
        <span class="step-number">3</span>
        <strong>Set a specific intensity (e.g., 60%)</strong>
      </div>

      <div class="test-step">
        <span class="step-number">4</span>
        <strong>Navigate to a different site (e.g., example.com)</strong>
      </div>

      <div class="test-step">
        <span class="step-number">5</span>
        <strong>Change settings on the new site:</strong>
        <ul>
          <li>Disable dark theme OR</li>
          <li>Set a different intensity (e.g., 90%)</li>
        </ul>
      </div>

      <div class="test-step">
        <span class="step-number">6</span>
        <strong>Navigate back to this test page</strong>
      </div>

      <div class="test-step">
        <span class="step-number">7</span>
        <strong>Verify site-specific settings are restored:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="site-specific-state">
          <label for="site-specific-state">Dark theme is enabled (as set in step 2)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="site-specific-intensity">
          <label for="site-specific-intensity">Intensity is 60% (as set in step 3)</label>
        </div>
      </div>

      <div class="test-step">
        <span class="step-number">8</span>
        <strong>Close and reopen the browser</strong>
      </div>

      <div class="test-step">
        <span class="step-number">9</span>
        <strong>Navigate to this test page again</strong>
      </div>

      <div class="test-step">
        <span class="step-number">10</span>
        <strong>Verify site-specific settings persisted after restart:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="site-persist-state">
          <label for="site-persist-state">Dark theme state is still as configured</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="site-persist-intensity">
          <label for="site-persist-intensity">Intensity is still 60%</label>
        </div>
      </div>

      <div class="success-box">
        <strong>‚úÖ Expected Result:</strong> Each site should remember its own dark theme settings independently.
      </div>
    </div>

    <h2>Test 5: Storage API Verification</h2>
    <div class="test-section">
      <p><strong>Goal:</strong> Manually verify chrome.storage.sync is working correctly</p>

      <div class="test-step">
        <span class="step-number">1</span>
        <strong>Open Chrome DevTools</strong>
        <p class="note">Press F12 or right-click ‚Üí Inspect</p>
      </div>

      <div class="test-step">
        <span class="step-number">2</span>
        <strong>Go to the Console tab</strong>
      </div>

      <div class="test-step">
        <span class="step-number">3</span>
        <strong>Run this command to check stored settings:</strong>
        <code style="display: block; padding: 10px; margin: 10px 0;">
                    chrome.storage.sync.get(null, (data) => console.log('Stored settings:', data));
                </code>
      </div>

      <div class="test-step">
        <span class="step-number">4</span>
        <strong>Verify the output shows:</strong>
        <div class="checkbox-item">
          <input type="checkbox" id="storage-enabled">
          <label for="storage-enabled">darkThemeEnabled property</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="storage-intensity">
          <label for="storage-intensity">intensity property</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="storage-whitelist">
          <label for="storage-whitelist">whitelist array (if implemented)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="storage-blacklist">
          <label for="storage-blacklist">blacklist array (if implemented)</label>
        </div>
        <div class="checkbox-item">
          <input type="checkbox" id="storage-site-settings">
          <label for="storage-site-settings">siteSettings object (if implemented)</label>
        </div>
      </div>

      <div class="test-step">
        <span class="step-number">5</span>
        <strong>Change a setting in the popup</strong>
      </div>

      <div class="test-step">
        <span class="step-number">6</span>
        <strong>Run the console command again</strong>
        <p class="note">Verify the stored data reflects the change</p>
      </div>

      <div class="success-box">
        <strong>‚úÖ Expected Result:</strong> Console should show all extension settings stored in chrome.storage.sync,
        and changes should be reflected immediately.
      </div>
    </div>

    <h2>üìä Test Summary</h2>
    <div class="test-section">
      <table>
        <tr>
          <th>Test</th>
          <th>Status</th>
          <th>Notes</th>
        </tr>
        <tr>
          <td>1. Popup Settings Persistence</td>
          <td><span class="status-indicator status-pending"></span>Pending</td>
          <td>_______________________</td>
        </tr>
        <tr>
          <td>2. Browser Restart Persistence</td>
          <td><span class="status-indicator status-pending"></span>Pending</td>
          <td>_______________________</td>
        </tr>
        <tr>
          <td>3. Cross-Instance Sync</td>
          <td><span class="status-indicator status-pending"></span>Pending</td>
          <td>_______________________</td>
        </tr>
        <tr>
          <td>4. Site-Specific Settings</td>
          <td><span class="status-indicator status-pending"></span>Pending</td>
          <td>_______________________</td>
        </tr>
        <tr>
          <td>5. Storage API Verification</td>
          <td><span class="status-indicator status-pending"></span>Pending</td>
          <td>_______________________</td>
        </tr>
      </table>
    </div>

    <h2>üêõ Common Issues & Troubleshooting</h2>
    <div class="test-section">
      <h3>Settings Not Persisting</h3>
      <ul>
        <li><strong>Check:</strong> Verify chrome.storage.sync permission is in manifest.json</li>
        <li><strong>Check:</strong> Look for errors in the extension's background page console</li>
        <li><strong>Check:</strong> Ensure storage.sync.set() is being called after changes</li>
      </ul>

      <h3>Sync Not Working</h3>
      <ul>
        <li><strong>Check:</strong> Verify you're signed into Chrome</li>
        <li><strong>Check:</strong> Ensure Chrome Sync is enabled in Settings</li>
        <li><strong>Check:</strong> Wait 2-3 minutes for sync to propagate</li>
        <li><strong>Check:</strong> Visit chrome://sync-internals to debug sync issues</li>
      </ul>

      <h3>Site-Specific Settings Not Working</h3>
      <ul>
        <li><strong>Check:</strong> Verify siteSettings object is being saved to storage</li>
        <li><strong>Check:</strong> Ensure hostname extraction is working correctly</li>
        <li><strong>Check:</strong> Look for console errors in content script</li>
      </ul>
    </div>

    <div class="test-content">
      <h3>Test Content Area</h3>
      <p>This is sample content to test the dark theme. When dark theme is enabled, this text should be light colored on
        a dark background.</p>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore
        magna aliqua.</p>
      <button>Sample Button</button>
      <input type="text" placeholder="Sample input field" style="margin: 10px 0; padding: 8px; width: 300px;">
    </div>
  </div>
</body>

</html>